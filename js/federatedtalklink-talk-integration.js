/*! For license information please see federatedtalklink-talk-integration.js.LICENSE.txt */
(()=>{"use strict";var e,n,t,r={244(e,n,t){var r=t(3814),o=t(5289),a=t(6802);function i(){var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",o=t.toStringTag||"@@toStringTag";function a(t,r,o,a){var i=r&&r.prototype instanceof c?r:c,u=Object.create(i.prototype);return l(u,"_invoke",function(t,r,o){var a,i,l,c=0,u=o||[],s=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(n,t){return a=n,i=0,l=e,p.n=t,d}};function f(t,r){for(i=t,l=r,n=0;!s&&c&&!o&&n<u.length;n++){var o,a=u[n],f=p.p,v=a[2];t>3?(o=v===r)&&(l=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=t<2&&f<a[1])?(i=0,p.v=r,p.n=a[1]):f<v&&(o=t<3||a[0]>r||r>v)&&(a[4]=t,a[5]=r,p.n=v,i=0))}if(o||t>1)return d;throw s=!0,r}return function(o,u,v){if(c>1)throw TypeError("Generator is already running");for(s&&1===u&&f(u,v),i=u,l=v;(n=i<2?e:l)||!s;){a||(i?i<3?(i>1&&(p.n=-1),f(i,l)):p.n=l:p.v=l);try{if(c=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,l)))throw TypeError("iterator result is not an object");if(!n.done)return n;l=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(s=p.n<0)?l:t.call(r,p))!==d)break}catch(n){a=e,i=1,l=n}finally{c=1}}return{value:n,done:s}}}(t,o,a),!0),u}var d={};function c(){}function u(){}function s(){}n=Object.getPrototypeOf;var p=[][r]?n(n([][r]())):(l(n={},r,function(){return this}),n),f=s.prototype=c.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,l(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=s,l(f,"constructor",s),l(s,"constructor",u),u.displayName="GeneratorFunction",l(s,o,"GeneratorFunction"),l(f),l(f,o,"Generator"),l(f,r,function(){return this}),l(f,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:v}})()}function l(e,n,t,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,n,t,r){function a(n,t){l(e,n,function(e){return this._invoke(n,t,e)})}n?o?o(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(a("next",0),a("throw",1),a("return",2))},l(e,n,t,r)}function d(e,n,t,r,o,a,i){try{var l=e[a](i),d=l.value}catch(e){return void t(e)}l.done?n(d):Promise.resolve(d).then(r,o)}function c(e){return function(){var n=this,t=arguments;return new Promise(function(r,o){var a=e.apply(n,t);function i(e){d(a,r,o,i,l,"next",e)}function l(e){d(a,r,o,i,l,"throw",e)}i(void 0)})}}var u=null,s=null,p=!1;function f(){console.log("[FederatedTalkLink] Initializing Talk integration"),setInterval(function(){var e=window.location.pathname.match(/\/call\/([a-zA-Z0-9]+)/)||window.location.hash.match(/\/call\/([a-zA-Z0-9]+)/),n=e?e[1]:null;n!==u&&(u=n,p=!1,n&&function(e){v.apply(this,arguments)}(n)),m()},1e3),new MutationObserver(function(){m()}).observe(document.body,{childList:!0,subtree:!0}),m()}function v(){return(v=c(i().m(function e(n){var t,o,l,d;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a.Ay.get((0,r.KT)("/apps/spreed/api/v4/room/".concat(n)),{headers:{"OCS-APIRequest":"true"}});case 1:l=e.v,s=(null===(t=l.data.ocs)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.displayName)||(null===(o=l.data.ocs)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.name)||null,console.log("[FederatedTalkLink] Conversation name:",s),e.n=3;break;case 2:e.p=2,d=e.v,console.log("[FederatedTalkLink] Could not fetch conversation name:",d),s=null;case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function m(){if(!p){var e=document.querySelector(".top-bar__wrapper")||document.querySelector(".conversation-header")||document.querySelector(".top-bar")||document.querySelector("#call-container .top-bar")||document.querySelector(".talk-sidebar-callview")||document.querySelector('[class*="top-bar"]');if(e)if(document.querySelector(".federated-link-topbar-button"))p=!0;else{var n=e.querySelector(".top-bar__buttons")||e.querySelector(".conversation-header__actions")||e.querySelector(".actions")||e.querySelector('[class*="actions"]')||e,t=function(){var e=document.createElement("button");return e.className="federated-link-topbar-button",e.title="Generate Federated Link",e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n        </svg>\n        <span class="federated-link-label">Federated Link</span>\n    ',e.style.cssText="\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 6px 12px;\n        margin: 4px;\n        border: none;\n        border-radius: 20px;\n        background: var(--color-primary, #0082c9);\n        color: var(--color-primary-text, white);\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n    ",e.addEventListener("mouseenter",function(){e.style.background="var(--color-primary-hover, #006aa3)"}),e.addEventListener("mouseleave",function(){e.style.background="var(--color-primary, #0082c9)"}),e.addEventListener("click",b),e}();n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t),p=!0,console.log("[FederatedTalkLink] Button added to top bar")}}}function b(){return y.apply(this,arguments)}function y(){return(y=c(i().m(function e(){var n,t,r,a;return i().w(function(e){for(;;)switch(e.n){case 0:if((n=s)||(r=document.querySelector(".conversation-name")||document.querySelector(".talk-sidebar-callview__displayname")||document.querySelector('[class*="conversation"] [class*="name"]')||document.querySelector(".displayname"),n=null==r||null===(t=r.textContent)||void 0===t?void 0:t.trim()),n||(n=prompt("Enter the room/conversation name:")),n){e.n=1;break}return(0,o.Qg)("Room name is required"),e.a(2);case 1:return e.n=2,g(n);case 2:(a=e.v)&&k(a,n);case 3:return e.a(2)}},e)}))).apply(this,arguments)}function g(e){return h.apply(this,arguments)}function h(){return(h=c(i().m(function e(n){var t,l,d,c,u,s,p;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return(0,o.cf)('Generating federated link for "'.concat(n,'"...')),e.p=1,e.n=2,a.Ay.get((0,r.KT)("/apps/federatedtalklink/api/v1/link"),{params:{roomName:n},headers:{"OCS-APIRequest":"true"}});case 2:if(l=e.v,null==(d=null===(t=l.data.ocs)||void 0===t?void 0:t.data)||!d.link){e.n=3;break}return e.a(2,d.link);case 3:if(null==d||!d.error){e.n=4;break}return(0,o.Qg)(d.error),e.a(2,null);case 4:return(0,o.Qg)("No link returned from server"),e.a(2,null);case 5:e.n=7;break;case 6:return e.p=6,p=e.v,s=(null===(c=p.response)||void 0===c||null===(c=c.data)||void 0===c||null===(c=c.ocs)||void 0===c||null===(c=c.data)||void 0===c?void 0:c.error)||(null===(u=p.response)||void 0===u||null===(u=u.data)||void 0===u||null===(u=u.ocs)||void 0===u||null===(u=u.meta)||void 0===u?void 0:u.message)||p.message||"Failed to generate federated link",(0,o.Qg)(s),e.a(2,null);case 7:return e.a(2)}},e,null,[[1,6]])}))).apply(this,arguments)}function k(e,n){var t=document.querySelector(".federated-link-dialog-overlay");t&&t.remove();var l=document.createElement("div");l.className="federated-link-dialog-overlay",l.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0, 0, 0, 0.5);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n    ";var d=document.createElement("div");d.className="federated-link-dialog",d.style.cssText="\n        background: var(--color-main-background, white);\n        border-radius: 12px;\n        padding: 24px;\n        max-width: 500px;\n        width: 90%;\n        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n    ",d.innerHTML='\n        <h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">Federated Link Generated</h3>\n\n        <div style="margin-bottom: 16px;">\n            <label style="display: block; font-weight: 500; margin-bottom: 6px;">Link:</label>\n            <div style="display: flex; gap: 8px;">\n                <input type="text" value="'.concat(e,'" readonly style="\n                    flex: 1;\n                    padding: 10px;\n                    border: 1px solid var(--color-border, #ddd);\n                    border-radius: 6px;\n                    background: var(--color-background-dark, #f5f5f5);\n                    font-family: monospace;\n                    font-size: 12px;\n                " />\n                <button class="federated-copy-btn" style="\n                    padding: 10px 16px;\n                    border: none;\n                    border-radius: 6px;\n                    background: var(--color-primary, #0082c9);\n                    color: white;\n                    cursor: pointer;\n                    font-weight: 500;\n                ">Copy</button>\n            </div>\n        </div>\n\n        <hr style="border: none; border-top: 1px solid var(--color-border, #ddd); margin: 20px 0;" />\n\n        <div style="margin-bottom: 16px;">\n            <label style="display: block; font-weight: 500; margin-bottom: 6px;">Send by Email:</label>\n            <div style="display: flex; gap: 8px;">\n                <input type="email" placeholder="Enter email address..." class="federated-email-input" style="\n                    flex: 1;\n                    padding: 10px;\n                    border: 1px solid var(--color-border, #ddd);\n                    border-radius: 6px;\n                    font-size: 14px;\n                " />\n                <button class="federated-send-btn" style="\n                    padding: 10px 16px;\n                    border: none;\n                    border-radius: 6px;\n                    background: var(--color-success, #46ba61);\n                    color: white;\n                    cursor: pointer;\n                    font-weight: 500;\n                ">Send</button>\n            </div>\n        </div>\n\n        <div style="display: flex; justify-content: flex-end; margin-top: 20px;">\n            <button class="federated-close-btn" style="\n                padding: 10px 20px;\n                border: 1px solid var(--color-border, #ddd);\n                border-radius: 6px;\n                background: transparent;\n                cursor: pointer;\n                font-weight: 500;\n            ">Close</button>\n        </div>\n    '),l.appendChild(d),document.body.appendChild(l);var u=d.querySelector(".federated-copy-btn"),s=d.querySelector(".federated-send-btn"),p=d.querySelector(".federated-close-btn"),f=d.querySelector(".federated-email-input");u.addEventListener("click",c(i().m(function n(){return i().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,navigator.clipboard.writeText(e);case 1:(0,o.Te)("Link copied to clipboard!"),u.textContent="Copied!",setTimeout(function(){u.textContent="Copy"},2e3),n.n=3;break;case 2:n.p=2,n.v,(0,o.Qg)("Failed to copy link");case 3:return n.a(2)}},n,null,[[0,2]])}))),s.addEventListener("click",c(i().m(function t(){var l,d,c,u,p,v,m;return i().w(function(t){for(;;)switch(t.p=t.n){case 0:if(l=f.value.trim()){t.n=1;break}return(0,o.Qg)("Please enter an email address"),t.a(2);case 1:return s.textContent="Sending...",s.disabled=!0,t.p=2,t.n=3,a.Ay.post((0,r.KT)("/apps/federatedtalklink/api/v1/email"),{email:l,link:e,roomName:n},{headers:{"OCS-APIRequest":"true"}});case 3:c=t.v,null!=(u=null===(d=c.data.ocs)||void 0===d?void 0:d.data)&&u.message?(0,o.Te)(u.message):(0,o.Te)("Email sent successfully!"),f.value="",t.n=5;break;case 4:t.p=4,m=t.v,v=(null===(p=m.response)||void 0===p||null===(p=p.data)||void 0===p||null===(p=p.ocs)||void 0===p||null===(p=p.data)||void 0===p?void 0:p.error)||m.message||"Failed to send email",(0,o.Qg)(v);case 5:return t.p=5,s.textContent="Send",s.disabled=!1,t.f(5);case 6:return t.a(2)}},t,null,[[2,4,5,6]])}))),f.addEventListener("keyup",function(e){"Enter"===e.key&&s.click()}),p.addEventListener("click",function(){l.remove()}),l.addEventListener("click",function(e){e.target===l&&l.remove()}),document.addEventListener("keydown",function e(n){"Escape"===n.key&&(l.remove(),document.removeEventListener("keydown",e))})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f()}},o={};function a(e){var n=o[e];if(void 0!==n)return n.exports;var t=o[e]={id:e,exports:{}};return r[e].call(t.exports,t,t.exports,a),t.exports}a.m=r,e=[],a.O=(n,t,r,o)=>{if(!t){var i=1/0;for(u=0;u<e.length;u++){for(var[t,r,o]=e[u],l=!0,d=0;d<t.length;d++)(!1&o||i>=o)&&Object.keys(a.O).every(e=>a.O[e](t[d]))?t.splice(d--,1):(l=!1,o<i&&(i=o));if(l){e.splice(u--,1);var c=r();void 0!==c&&(n=c)}}return n}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[t,r,o]},a.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return a.d(n,{a:n}),n},a.d=(e,n)=>{for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((n,t)=>(a.f[t](e,n),n),[])),a.u=e=>e+"-13f3371e171971bf5529.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),n={},t="federatedtalklink:",a.l=(e,r,o,i)=>{if(n[e])n[e].push(r);else{var l,d;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var s=c[u];if(s.getAttribute("src")==e||s.getAttribute("data-webpack")==t+o){l=s;break}}l||(d=!0,(l=document.createElement("script")).charset="utf-8",a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",t+o),l.src=e),n[e]=[r];var p=(t,r)=>{l.onerror=l.onload=null,clearTimeout(f);var o=n[e];if(delete n[e],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach(e=>e(r)),t)return t(r)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),d&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var n=a.g.document;if(!e&&n&&(n.currentScript&&"SCRIPT"===n.currentScript.tagName.toUpperCase()&&(e=n.currentScript.src),!e)){var t=n.getElementsByTagName("script");if(t.length)for(var r=t.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=t[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={307:0};a.f.j=(n,t)=>{var r=a.o(e,n)?e[n]:void 0;if(0!==r)if(r)t.push(r[2]);else{var o=new Promise((t,o)=>r=e[n]=[t,o]);t.push(r[2]=o);var i=a.p+a.u(n),l=new Error;a.l(i,t=>{if(a.o(e,n)&&(0!==(r=e[n])&&(e[n]=void 0),r)){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;l.message="Loading chunk "+n+" failed.\n("+o+": "+i+")",l.name="ChunkLoadError",l.type=o,l.request=i,r[1](l)}},"chunk-"+n,n)}},a.O.j=n=>0===e[n];var n=(n,t)=>{var r,o,[i,l,d]=t,c=0;if(i.some(n=>0!==e[n])){for(r in l)a.o(l,r)&&(a.m[r]=l[r]);if(d)var u=d(a)}for(n&&n(t);c<i.length;c++)o=i[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(u)},t=self.webpackChunkfederatedtalklink=self.webpackChunkfederatedtalklink||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})(),a.nc=void 0;var i=a.O(void 0,[397],()=>a(244));i=a.O(i)})();
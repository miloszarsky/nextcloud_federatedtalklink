/*! For license information please see federatedtalklink-talk-integration.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,n={244(e,t,r){var n=r(3814),o=r(5289),a=r(6802);function i(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var i=n&&n.prototype instanceof u?n:u,d=Object.create(i.prototype);return l(d,"_invoke",function(r,n,o){var a,i,l,u=0,d=o||[],s=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,r){return a=t,i=0,l=e,p.n=r,c}};function f(r,n){for(i=r,l=n,t=0;!s&&u&&!o&&t<d.length;t++){var o,a=d[t],f=p.p,v=a[2];r>3?(o=v===n)&&(l=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=f&&((o=r<2&&f<a[1])?(i=0,p.v=n,p.n=a[1]):f<v&&(o=r<3||a[0]>n||n>v)&&(a[4]=r,a[5]=n,p.n=v,i=0))}if(o||r>1)return c;throw s=!0,n}return function(o,d,v){if(u>1)throw TypeError("Generator is already running");for(s&&1===d&&f(d,v),i=d,l=v;(t=i<2?e:l)||!s;){a||(i?i<3?(i>1&&(p.n=-1),f(i,l)):p.n=l:p.v=l);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(s=p.n<0)?l:r.call(n,p))!==c)break}catch(t){a=e,i=1,l=t}finally{u=1}}return{value:t,done:s}}}(r,o,a),!0),d}var c={};function u(){}function d(){}function s(){}t=Object.getPrototypeOf;var p=[][n]?t(t([][n]())):(l(t={},n,function(){return this}),t),f=s.prototype=u.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,l(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return d.prototype=s,l(f,"constructor",s),l(s,"constructor",d),d.displayName="GeneratorFunction",l(s,o,"GeneratorFunction"),l(f),l(f,o,"Generator"),l(f,n,function(){return this}),l(f,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:v}})()}function l(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,r,n){function a(t,r){l(e,t,function(e){return this._invoke(t,r,e)})}t?o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r:(a("next",0),a("throw",1),a("return",2))},l(e,t,r,n)}function c(e,t,r,n,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void r(e)}l.done?t(c):Promise.resolve(c).then(n,o)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){c(a,n,o,i,l,"next",e)}function l(e){c(a,n,o,i,l,"throw",e)}i(void 0)})}}var d=null,s=null,p=!1;function f(){console.log("[FederatedTalkLink] Initializing Talk integration"),setInterval(function(){var e=window.location.pathname.match(/\/call\/([a-zA-Z0-9]+)/)||window.location.hash.match(/\/call\/([a-zA-Z0-9]+)/),t=e?e[1]:null;t!==d&&(d=t,p=!1,t&&function(e){v.apply(this,arguments)}(t)),m()},1e3),new MutationObserver(function(){m()}).observe(document.body,{childList:!0,subtree:!0}),m()}function v(){return(v=u(i().m(function e(t){var r,o,l,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,a.Ay.get((0,n.KT)("/apps/spreed/api/v4/room/".concat(t)),{headers:{"OCS-APIRequest":"true"}});case 1:l=e.v,s=(null===(r=l.data.ocs)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.displayName)||(null===(o=l.data.ocs)||void 0===o||null===(o=o.data)||void 0===o?void 0:o.name)||null,console.log("[FederatedTalkLink] Conversation name:",s),e.n=3;break;case 2:e.p=2,c=e.v,console.log("[FederatedTalkLink] Could not fetch conversation name:",c),s=null;case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function m(){if(!p){var e=document.querySelector(".top-bar__wrapper")||document.querySelector(".conversation-header")||document.querySelector(".top-bar")||document.querySelector("#call-container .top-bar")||document.querySelector(".talk-sidebar-callview")||document.querySelector('[class*="top-bar"]');if(e)if(document.querySelector(".federated-link-topbar-button"))p=!0;else{var t=e.querySelector(".top-bar__buttons")||e.querySelector(".conversation-header__actions")||e.querySelector(".actions")||e.querySelector('[class*="actions"]')||e,r=function(){var e=document.createElement("button");return e.className="federated-link-topbar-button",e.title="Generate Federated Link",e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>\n            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>\n        </svg>\n        <span class="federated-link-label">Federated Link</span>\n    ',e.style.cssText="\n        display: inline-flex;\n        align-items: center;\n        gap: 6px;\n        padding: 6px 12px;\n        margin: 4px;\n        border: none;\n        border-radius: 20px;\n        background: var(--color-primary, #0082c9);\n        color: var(--color-primary-text, white);\n        cursor: pointer;\n        font-size: 13px;\n        font-weight: 500;\n        transition: background 0.2s;\n    ",e.addEventListener("mouseenter",function(){e.style.background="var(--color-primary-hover, #006aa3)"}),e.addEventListener("mouseleave",function(){e.style.background="var(--color-primary, #0082c9)"}),e.addEventListener("click",h),e}();t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r),p=!0,console.log("[FederatedTalkLink] Button added to top bar")}}}function h(){return b.apply(this,arguments)}function b(){return(b=u(i().m(function e(){var t,r,n;return i().w(function(e){for(;;)switch(e.n){case 0:if((t=s)||(n=document.querySelector(".conversation-name")||document.querySelector(".talk-sidebar-callview__displayname")||document.querySelector('[class*="conversation"] [class*="name"]')||document.querySelector(".displayname"),t=null==n||null===(r=n.textContent)||void 0===r?void 0:r.trim()),t||(t=prompt("Enter the room/conversation name:")),t){e.n=1;break}return(0,o.Qg)("Room name is required"),e.a(2);case 1:return e.n=2,y(t);case 2:return e.a(2)}},e)}))).apply(this,arguments)}function y(e){return g.apply(this,arguments)}function g(){return(g=u(i().m(function e(t){var r,l,c,u,d,s,p;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return(0,o.cf)('Generating federated link for "'.concat(t,'"...')),e.p=1,e.n=2,a.Ay.get((0,n.KT)("/apps/federatedtalklink/api/v1/link"),{params:{roomName:t},headers:{"OCS-APIRequest":"true"}});case 2:if(l=e.v,null==(c=null===(r=l.data.ocs)||void 0===r?void 0:r.data)||!c.link){e.n=7;break}return e.p=3,e.n=4,navigator.clipboard.writeText(c.link);case 4:(0,o.Te)("Link copied: ".concat(c.link)),e.n=6;break;case 5:e.p=5,e.v,(0,o.Te)("Federated link: ".concat(c.link)),prompt("Copy this link:",c.link);case 6:e.n=8;break;case 7:null!=c&&c.error?(0,o.Qg)(c.error):(0,o.Qg)("No link returned from server");case 8:e.n=10;break;case 9:e.p=9,p=e.v,s=(null===(u=p.response)||void 0===u||null===(u=u.data)||void 0===u||null===(u=u.ocs)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.error)||(null===(d=p.response)||void 0===d||null===(d=d.data)||void 0===d||null===(d=d.ocs)||void 0===d||null===(d=d.meta)||void 0===d?void 0:d.message)||p.message||"Failed to generate federated link",(0,o.Qg)(s);case 10:return e.a(2)}},e,null,[[3,5],[1,9]])}))).apply(this,arguments)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f()}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var r=o[e]={id:e,exports:{}};return n[e].call(r.exports,r,r.exports,a),r.exports}a.m=n,e=[],a.O=(t,r,n,o)=>{if(!r){var i=1/0;for(d=0;d<e.length;d++){for(var[r,n,o]=e[d],l=!0,c=0;c<r.length;c++)(!1&o||i>=o)&&Object.keys(a.O).every(e=>a.O[e](r[c]))?r.splice(c--,1):(l=!1,o<i&&(i=o));if(l){e.splice(d--,1);var u=n();void 0!==u&&(t=u)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,n,o]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,r)=>(a.f[r](e,t),t),[])),a.u=e=>e+"-13f3371e171971bf5529.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},r="federatedtalklink:",a.l=(e,n,o,i)=>{if(t[e])t[e].push(n);else{var l,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),d=0;d<u.length;d++){var s=u[d];if(s.getAttribute("src")==e||s.getAttribute("data-webpack")==r+o){l=s;break}}l||(c=!0,(l=document.createElement("script")).charset="utf-8",a.nc&&l.setAttribute("nonce",a.nc),l.setAttribute("data-webpack",r+o),l.src=e),t[e]=[n];var p=(r,n)=>{l.onerror=l.onload=null,clearTimeout(f);var o=t[e];if(delete t[e],l.parentNode&&l.parentNode.removeChild(l),o&&o.forEach(e=>e(n)),r)return r(n)},f=setTimeout(p.bind(null,void 0,{type:"timeout",target:l}),12e4);l.onerror=p.bind(null,l.onerror),l.onload=p.bind(null,l.onload),c&&document.head.appendChild(l)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{a.b="undefined"!=typeof document&&document.baseURI||self.location.href;var e={307:0};a.f.j=(t,r)=>{var n=a.o(e,t)?e[t]:void 0;if(0!==n)if(n)r.push(n[2]);else{var o=new Promise((r,o)=>n=e[t]=[r,o]);r.push(n[2]=o);var i=a.p+a.u(t),l=new Error;a.l(i,r=>{if(a.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var o=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.src;l.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",l.name="ChunkLoadError",l.type=o,l.request=i,n[1](l)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,r)=>{var n,o,[i,l,c]=r,u=0;if(i.some(t=>0!==e[t])){for(n in l)a.o(l,n)&&(a.m[n]=l[n]);if(c)var d=c(a)}for(t&&t(r);u<i.length;u++)o=i[u],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},r=self.webpackChunkfederatedtalklink=self.webpackChunkfederatedtalklink||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),a.nc=void 0;var i=a.O(void 0,[397],()=>a(244));i=a.O(i)})();